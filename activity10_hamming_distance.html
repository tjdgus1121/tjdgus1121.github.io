<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ğŸ” SEO (ê²€ìƒ‰ì—”ì§„ ìµœì í™”) -->
    <title>ì†ê¸€ì”¨ ìˆ«ì to 28x28 í–‰ë ¬ ë³€í™˜ê¸°</title>
    <meta name="description" content="ì†ê¸€ì”¨ë¡œ ê·¸ë¦° ìˆ«ìë¥¼ 28x28 í–‰ë ¬ë¡œ ë³€í™˜í•˜ì—¬ MNIST ë°ì´í„°ì…‹ í˜•ì‹ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì›¹ ë„êµ¬ì…ë‹ˆë‹¤.">
    <meta name="keywords" content="ì†ê¸€ì”¨ ì¸ì‹, MNIST, í–‰ë ¬ ë³€í™˜, 28x28, ì´ë¯¸ì§€ ì²˜ë¦¬, ì¸ê³µì§€ëŠ¥ ìˆ˜í•™, êµìœ¡ìš© ì›¹ì‚¬ì´íŠ¸">
    <meta name="author" content="í™©ì„±í˜„">
    <meta name="google-site-verification" content="s7dTY3TNe-PjxGrl--MTPXDXJcgD2V7_6MDZ4SoEDP8" />
    <meta name="naver-site-verification" content="c020330e12eea0ae1a607097941a61b11590df69" />

    <!-- ğŸ“± SNS ê³µìœ  (Open Graph) -->
    <meta property="og:title" content="ì†ê¸€ì”¨ ìˆ«ì to 28x28 í–‰ë ¬ ë³€í™˜ê¸°">
    <meta property="og:description" content="ì†ê¸€ì”¨ë¡œ ê·¸ë¦° ìˆ«ìë¥¼ MNIST ë°ì´í„°ì…‹ í˜•ì‹ì˜ 28x28 í–‰ë ¬ë¡œ ë³€í™˜í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆëŠ” êµìœ¡ìš© ì›¹ ë„êµ¬ì…ë‹ˆë‹¤.">
    <meta property="og:image" content="https://tjdgus1121.github.io/thumbnail.png">
    <meta property="og:url" content="https://tjdgus1121.github.io/activity10_hamming_distance.html">
    <meta property="og:type" content="website">

    <!-- ğŸ” SEO (ì¶”ê°€ ë©”íƒ€ë°ì´í„°) -->
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://tjdgus1121.github.io/activity10_hamming_distance.html">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ì†ê¸€ì”¨ ìˆ«ì to 28x28 í–‰ë ¬ ë³€í™˜ê¸°">
    <meta name="twitter:description" content="ì†ê¸€ì”¨ë¡œ ê·¸ë¦° ìˆ«ìë¥¼ MNIST ë°ì´í„°ì…‹ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•´ë³´ì„¸ìš”.">
    <meta name="twitter:image" content="https://tjdgus1121.github.io/thumbnail.png">

    <meta name="subject" content="AI ìˆ˜í•™ êµìœ¡ ì²´í—˜">
    <meta name="theme-color" content="#ff9a9e">
    <meta name="copyright" content="í™©ì„±í˜„">
    <meta name="reply-to" content="tjdgus1121@naver.com">
    <meta name="url" content="https://tjdgus1121.github.io/activity10_hamming_distance.html">

    <!-- ğŸ“ ìŠ¤íƒ€ì¼ ë° í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Jua&family=Nanum+Pen+Script&family=Noto+Sans+KR:wght@100..900&family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-family: "Do Hyeon";
            font-weight: 300;
            font-size:3em;
        }
        .canvas-section {
            text-align: center;
            margin-bottom: 30px;
        }
        #drawingCanvas {
            border: 2px solid #333;
            cursor: crosshair;
            background-color: white;
            border-radius: 5px;
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .clear-btn {
            background-color: #f44336;
        }
        .clear-btn:hover {
            background-color: #da190b;
        }
        .output-section {
            margin-top: 30px;
        }
        .matrix-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }
        .matrix-display {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: #fafafa;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .matrix-title {
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #555;
        }
        .visual-matrix {
            display: grid;
            grid-template-columns: repeat(28, 1fr);
            gap: 1px;
            width: 450px;
            height: 450px;
            border: 1px solid #ccc;
            background-color: white;
        }
        .pixel {
            width: 100%;
            height: 100%;
            font-size: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }
        .numeric-matrix {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            line-height: 1.1;
            letter-spacing: 0px;
            white-space: pre;
            text-align: center;
            overflow: auto;
            background-color: white;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 3px;
            display: grid;
            grid-template-columns: repeat(28, 1fr);
            gap: 1px;
            width: 450px;
            height: 450px;
            max-width: 450px;
            max-height: 450px;
        }
        .matrix-cell {
            width: 12px; /* ì…€ í¬ê¸° ì¡°ì • */
            height: 12px; /* ì…€ í¬ê¸° ì¡°ì • */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 7px; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
            border: 0.5px solid #eee;
            background-color: white;
        }
        .matrix-cell.highlight {
            background-color: #ffeb3b;
            font-weight: bold;
        }
        .compact-matrix {
            font-family: 'Courier New', monospace;
            font-size: 9px;
            line-height: 1.0;
            letter-spacing: 0px;
            white-space: pre;
            text-align: left;
            overflow: auto;
            width: 450px;
            height: 450px;
            max-width: 450px;
            max-height: 450px;
            background-color: white;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 3px;
        }
        .matrix-flex-row {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        .button-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .button-column button {
            width: 160px;
            padding: 12px 24px;
            margin: 0;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .button-column button:hover {
            opacity: 0.9;
        }
        .button-column button:disabled {
             background-color: #cccccc;
             cursor: not-allowed;
        }
        /* ë²„íŠ¼ ìƒ‰ìƒ í´ë˜ìŠ¤ */
        .btn-primary {
            background-color: #2196F3;
            color: white;
        }
        .btn-success {
            background-color: #4CAF50;
            color: white;
        }
        .btn-warning {
            background-color: #FF9800;
            color: white;
        }
        .btn-danger {
            background-color: #FF5722;
            color: white;
        }
        .stats {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        .instructions {
            background-color: #e7f4f7;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #1976D2;
        }
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .matrix-tabs {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            font-size: 12px;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .numeric-matrix-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–Šï¸ ì†ê¸€ì”¨ ìˆ«ì â†’ 28Ã—28 í–‰ë ¬ ë³€í™˜ê¸°</h1>
        
        <div class="instructions">
            <h3>ì‚¬ìš©ë²•</h3>
            <ul>
                <li>ì•„ë˜ ìº”ë²„ìŠ¤ì— ë§ˆìš°ìŠ¤ë¡œ ìˆ«ì 0~9ë¥¼ ê·¸ë ¤ë³´ì„¸ìš”</li>
                <li>"ë³€í™˜" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ 28Ã—28 í”½ì…€ë¡œ ë³€í™˜ë©ë‹ˆë‹¤</li>
                <li>ê° í”½ì…€ì˜ ëª…ë„ê°’ì´ 0~255 ë²”ìœ„ì˜ ìˆ«ìë¡œ í‘œì‹œë©ë‹ˆë‹¤ (ê²€ì •=0, í°ìƒ‰=255)</li>
                <li>MNIST ë°ì´í„°ì…‹ê³¼ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤</li>
            </ul>
        </div>

        <div class="canvas-section">
            <canvas id="drawingCanvas" width="400" height="400"></canvas>
        </div>

        <div class="controls">
            <button id="convertBtn">ğŸ”„ 28Ã—28 í–‰ë ¬ë¡œ ë³€í™˜</button>
            <button id="clearBtn" class="clear-btn">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
        </div>

        <div class="output-section" id="outputSection" style="display: none;">
            <h2 style="text-align: center; color: #333;">ë³€í™˜ ê²°ê³¼</h2>
            
            <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ë“¤ì„ ìƒë‹¨ì— ë°°ì¹˜ -->
            <div style="text-align: center; margin-bottom: 20px; padding: 15px; background-color: #f8f8f8; border-radius: 5px;">
                <h4 style="margin: 0 0 10px 0; color: #555;">ì•„ë˜ì—ì„œ ì‹œê°ì  í‘œí˜„ê³¼ ìˆ«ì ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</h4>
                 
            </div>
            
            <div class="matrix-container">
                <div class="matrix-display">
                    <div class="matrix-title">ì‹œê°ì  í‘œí˜„ (28Ã—28)</div>
                    <div class="visual-matrix" id="visualMatrix"></div>
                    <div class="stats" id="visualStats"></div>
                </div>
                
                <div class="matrix-display">
                    <div class="matrix-title">ìˆ«ì í–‰ë ¬ í‘œì‹œ</div>
                    <!-- ìˆ«ì í–‰ë ¬ê³¼ ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ìƒˆë¡œìš´ flex ì»¨í…Œì´ë„ˆ -->
                    <div class="numeric-matrix-container">
                        <div class="numeric-matrix" id="numericMatrix"></div>
                        <div class="button-column">
                            <button id="copyExcelBtn" class="btn-primary">ğŸ“‹ ì—‘ì…€ ë³µì‚¬</button>
                            <button id="downloadCsvBtn" class="btn-success">ğŸ“ CSV ë‹¤ìš´</button>
                            <button id="downloadPng28" class="btn-warning">ğŸ–¼ï¸ PNG (28Ã—28)</button>
                            <button id="downloadPng280" class="btn-danger">ğŸ–¼ï¸ PNG (280Ã—280)</button>
                        </div>
                    </div>
                    <div class="stats" id="numericStats"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === ìƒìˆ˜ ì •ì˜ ===
        const MATRIX_SIZE = 28; // MNIST ë°ì´í„°ì…‹ í¬ê¸° (ê°€ë¡œ/ì„¸ë¡œ í”½ì…€ ìˆ˜)
        const DRAWING_CANVAS_SIZE = 400; // ì†ê¸€ì”¨ ì…ë ¥ ìº”ë²„ìŠ¤ í¬ê¸° (í”½ì…€)
        const VISUAL_MATRIX_SIZE_PX = 450; // ì‹œê°ì  í–‰ë ¬ í‘œì‹œ í¬ê¸° (í”½ì…€)
        const NUMERIC_MATRIX_CELL_SIZE_PX = 12; // ê²©ìí˜• ìˆ«ì í–‰ë ¬ ì…€ í¬ê¸° (í”½ì…€)
        const NUMERIC_MATRIX_FONT_SIZE_PX = 7;  // ê²©ìí˜• ìˆ«ì í–‰ë ¬ í°íŠ¸ í¬ê¸° (í”½ì…€)
        const HIGHLIGHT_THRESHOLD = 127; // ìˆ«ì í–‰ë ¬ì—ì„œ ê°•ì¡° í‘œì‹œí•  ì„ê³„ê°’ (0-255)
        const PEN_STROKE_WIDTH = 15; // ì†ê¸€ì”¨ ê·¸ë¦¬ê¸° íœ êµµê¸°
        const MAX_PIXEL_VALUE = 255; // í”½ì…€ ëª…ë„ ìµœëŒ€ê°’ (í°ìƒ‰)

        class DigitCanvasConverter {
            constructor() {
                this.canvas = document.getElementById('drawingCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.isDrawing = false;
                this.setupCanvas();
                this.setupEventListeners();
                this.currentMatrix = null; // ë³€í™˜ëœ í–‰ë ¬ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜ (ë‹¤ìš´ë¡œë“œ/ë³µì‚¬ ê¸°ëŠ¥ì— ì‚¬ìš©)
            }

            // ìº”ë²„ìŠ¤ ì´ˆê¸° ì„¤ì • (ë°°ê²½ìƒ‰, íœ ìŠ¤íƒ€ì¼ ë“±)
            setupCanvas() {
                // ìº”ë²„ìŠ¤ ë°°ê²½ì„ í°ìƒ‰ìœ¼ë¡œ ì±„ìš°ê¸°
                this.ctx.fillStyle = 'white';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // íœ ìŠ¤íƒ€ì¼ ì„¤ì •
                this.ctx.strokeStyle = 'black'; // íœ ìƒ‰ìƒ ê²€ì •
                this.ctx.lineWidth = PEN_STROKE_WIDTH; // íœ êµµê¸°
                this.ctx.lineCap = 'round'; // ì„  ë ëª¨ì–‘ ë‘¥ê¸€ê²Œ
                this.ctx.lineJoin = 'round'; // ì„  ì—°ê²° ë¶€ë¶„ ëª¨ì–‘ ë‘¥ê¸€ê²Œ
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (ë§ˆìš°ìŠ¤, í„°ì¹˜, ë²„íŠ¼)
            setupEventListeners() {
                // ì†ê¸€ì”¨ ê·¸ë¦¬ê¸° ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
                this.canvas.addEventListener('mousedown', (e) => this.startDrawing(e));
                this.canvas.addEventListener('mousemove', (e) => this.draw(e));
                this.canvas.addEventListener('mouseup', () => this.stopDrawing());
                this.canvas.addEventListener('mouseout', () => this.stopDrawing());

                // ì†ê¸€ì”¨ ê·¸ë¦¬ê¸° í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ì§€ì›)
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // ê¸°ë³¸ í„°ì¹˜ ì•¡ì…˜ ë°©ì§€ (ìŠ¤í¬ë¡¤ ë“±)
                    const touch = e.touches[0];
                    // í„°ì¹˜ ì´ë²¤íŠ¸ë¥¼ ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ë¡œ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬
                    const mouseEvent = new MouseEvent('mousedown', {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    });
                    this.canvas.dispatchEvent(mouseEvent); // ë³€í™˜ëœ ì´ë²¤íŠ¸ ë°œìƒ
                });

                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault(); // ê¸°ë³¸ í„°ì¹˜ ì•¡ì…˜ ë°©ì§€
                    const touch = e.touches[0];
                    // í„°ì¹˜ ì´ë²¤íŠ¸ë¥¼ ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ë¡œ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬
                    const mouseEvent = new MouseEvent('mousemove', {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    });
                    this.canvas.dispatchEvent(mouseEvent); // ë³€í™˜ëœ ì´ë²¤íŠ¸ ë°œìƒ
                });

                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault(); // ê¸°ë³¸ í„°ì¹˜ ì•¡ì…˜ ë°©ì§€
                    // í„°ì¹˜ ì´ë²¤íŠ¸ë¥¼ ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ë¡œ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬
                    const mouseEvent = new MouseEvent('mouseup', {});
                    this.canvas.dispatchEvent(mouseEvent); // ë³€í™˜ëœ ì´ë²¤íŠ¸ ë°œìƒ
                });

                // ë³€í™˜ ë° ì§€ìš°ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
                document.getElementById('convertBtn').addEventListener('click', () => this.convertToMatrix());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearCanvas());

                // ë‹¤ìš´ë¡œë“œ/ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸
                document.getElementById('copyExcelBtn').addEventListener('click', () => this.copyToClipboard());
                document.getElementById('downloadCsvBtn').addEventListener('click', () => this.downloadMatrix());
                document.getElementById('downloadPng28').addEventListener('click', () => this.downloadPNG());
                document.getElementById('downloadPng280').addEventListener('click', () => this.downloadPNGLarge());
            }

            // ë§ˆìš°ìŠ¤/í„°ì¹˜ ì¢Œí‘œë¥¼ ìº”ë²„ìŠ¤ ë‚´ ì¢Œí‘œë¡œ ë³€í™˜
            getMousePos(e) {
                const rect = this.canvas.getBoundingClientRect(); // ìº”ë²„ìŠ¤ ìš”ì†Œì˜ í™”ë©´ ì¢Œí‘œ ë° í¬ê¸°
                return {
                    x: e.clientX - rect.left, // ì´ë²¤íŠ¸ ì¢Œí‘œ - ìº”ë²„ìŠ¤ ì¢Œì¸¡ ê²½ê³„
                    y: e.clientY - rect.top // ì´ë²¤íŠ¸ ì¢Œí‘œ - ìº”ë²„ìŠ¤ ìƒë‹¨ ê²½ê³„
                };
            }

            // ê·¸ë¦¬ê¸° ì‹œì‘
            startDrawing(e) {
                this.isDrawing = true;
                const pos = this.getMousePos(e);
                this.ctx.beginPath(); // ìƒˆ ê²½ë¡œ ì‹œì‘
                this.ctx.moveTo(pos.x, pos.y); // ì‹œì‘ì  ì´ë™
            }

            // ê·¸ë¦¬ëŠ” ì¤‘ (ì„  ê·¸ë¦¬ê¸°)
            draw(e) {
                if (!this.isDrawing) return;
                
                const pos = this.getMousePos(e);
                this.ctx.lineTo(pos.x, pos.y); // í˜„ì¬ ìœ„ì¹˜ê¹Œì§€ ì„  ê·¸ë¦¬ê¸°
                this.ctx.stroke(); // ì„  ê·¸ë¦¬ê¸° ì‹¤í–‰
            }

            // ê·¸ë¦¬ê¸° ì¢…ë£Œ
            stopDrawing() {
                this.isDrawing = false;
            }

            // ìº”ë²„ìŠ¤ ì§€ìš°ê¸°
            clearCanvas() {
                this.setupCanvas(); // ìº”ë²„ìŠ¤ ì´ˆê¸° ì„¤ì • ë‹¤ì‹œ ì ìš© (í°ìƒ‰ ë°°ê²½)
                document.getElementById('outputSection').style.display = 'none'; // ê²°ê³¼ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                this.currentMatrix = null; // í–‰ë ¬ ë°ì´í„° ì´ˆê¸°í™”
            }

            // ì†ê¸€ì”¨ ì´ë¯¸ì§€ë¥¼ 28x28 í–‰ë ¬ë¡œ ë³€í™˜
            convertToMatrix() {
                // ì„ì‹œ ìº”ë²„ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì›ë³¸ ìº”ë²„ìŠ¤ ë‚´ìš©ì„ 28x28ë¡œ ì¶•ì†Œ
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = MATRIX_SIZE;
                tempCanvas.height = MATRIX_SIZE;

                // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ì‹œ ë³´ê°„ ì„¤ì •
                tempCtx.imageSmoothingEnabled = true; // ì´ë¯¸ì§€ ìŠ¤ë¬´ë”© í™œì„±í™”
                tempCtx.imageSmoothingQuality = 'high'; // ìŠ¤ë¬´ë”© í’ˆì§ˆ ë†’ìŒ

                // ì›ë³¸ ìº”ë²„ìŠ¤ ë‚´ìš©ì„ 28x28 ì„ì‹œ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸° (ìë™ ì¶•ì†Œ)
                tempCtx.drawImage(this.canvas, 0, 0, MATRIX_SIZE, MATRIX_SIZE);

                // ì¶•ì†Œëœ ì´ë¯¸ì§€ì—ì„œ í”½ì…€ ë°ì´í„° ì¶”ì¶œ (28x28)
                const imageData = tempCtx.getImageData(0, 0, MATRIX_SIZE, MATRIX_SIZE);
                const data = imageData.data; // í”½ì…€ ë°ì´í„° (RGBA ë°°ì—´)

                // í”½ì…€ ë°ì´í„°ë¥¼ 28x28 í–‰ë ¬ë¡œ ë³€í™˜ (grayscale ê°’ ì‚¬ìš©)
                const matrix = [];
                for (let y = 0; y < MATRIX_SIZE; y++) {
                    const row = [];
                    for (let x = 0; x < MATRIX_SIZE; x++) {
                        // RGBA ë°ì´í„°ëŠ” í•œ í”½ì…€ë‹¹ 4ê°œì˜ ê°’ (R, G, B, A)ì„ ê°€ì§
                        const index = (y * MATRIX_SIZE + x) * 4;
                        const r = data[index];
                        const g = data[index + 1];
                        const b = data[index + 2];
                        // const a = data[index + 3]; // ì•ŒíŒŒê°’ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
                        
                        // RGB ê°’ì„ í‘œì¤€ ê³µì‹ì— ë”°ë¼ grayscale(ëª…ë„) ê°’ìœ¼ë¡œ ë³€í™˜
                        const grayscale = Math.round(0.299 * r + 0.587 * g + 0.114 * b);
                        
                        // MNIST ë°ì´í„° í˜•ì‹ì— ë§ì¶° ê°’ ë°˜ì „ (ì›ë˜ MNISTëŠ” ê²€ì€ìƒ‰ í”½ì…€ì´ ë†’ì€ ê°’)
                        // ìº”ë²„ìŠ¤ì—ì„œ ê·¸ë¦° ê²€ì€ìƒ‰(RGB ì‘ìŒ)ì„ ë†’ì€ ê°’(255)ìœ¼ë¡œ, í°ìƒ‰(RGB í¼)ì„ ë‚®ì€ ê°’(0)ìœ¼ë¡œ ë³€í™˜
                        const mnistValue = MAX_PIXEL_VALUE - grayscale;
                        
                        row.push(mnistValue); // í–‰ë ¬ì— ë³€í™˜ëœ ê°’ ì¶”ê°€
                    }
                    matrix.push(row); // í–‰ë ¬ì— í–‰ ì¶”ê°€
                }

                this.currentMatrix = matrix; // ë³€í™˜ëœ í–‰ë ¬ ë°ì´í„°ë¥¼ í´ë˜ìŠ¤ ë©¤ë²„ ë³€ìˆ˜ì— ì €ì¥
                this.displayMatrix(matrix); // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜ í˜¸ì¶œ
            }

            // ë³€í™˜ ê²°ê³¼ (ì‹œê°ì  ë° ìˆ«ì í–‰ë ¬) í‘œì‹œ
            displayMatrix(matrix) {
                this.displayVisualMatrix(matrix); // ì‹œê°ì  í–‰ë ¬ í‘œì‹œ
                this.displayNumericMatrix(matrix); // ìˆ«ì í–‰ë ¬ í‘œì‹œ
                document.getElementById('outputSection').style.display = 'block'; // ê²°ê³¼ ì„¹ì…˜ ë³´ì´ê¸°
            }

            // ì‹œê°ì  í‘œí˜„ (28x28 í”½ì…€ ê·¸ë¦¬ë“œ) í‘œì‹œ
            displayVisualMatrix(matrix) {
                const visualMatrix = document.getElementById('visualMatrix');
                const visualStats = document.getElementById('visualStats');
                
                visualMatrix.innerHTML = ''; // ì´ì „ ë‚´ìš© ì§€ìš°ê¸°
                
                let nonZeroCount = 0; // 0ì´ ì•„ë‹Œ í”½ì…€ ìˆ˜ ì¹´ìš´íŠ¸
                let minVal = MAX_PIXEL_VALUE, maxVal = 0; // ìµœì†Œ/ìµœëŒ€ í”½ì…€ ê°’ ì¶”ì 
                
                // 28x28 ê·¸ë¦¬ë“œ ìƒì„± ë° ê° í”½ì…€ í‘œì‹œ
                for (let y = 0; y < MATRIX_SIZE; y++) {
                    for (let x = 0; x < MATRIX_SIZE; x++) {
                        const value = matrix[y][x]; // í–‰ë ¬ì—ì„œ í”½ì…€ ê°’ ê°€ì ¸ì˜¤ê¸°
                        const pixel = document.createElement('div');
                        pixel.className = 'pixel';
                        
                        // í”½ì…€ ê°’ì— ë”°ë¼ ë°°ê²½ìƒ‰ ì„¤ì • (grayscale). ê°’ì´ ë†’ì„ìˆ˜ë¡(ì–´ë‘ìš¸ìˆ˜ë¡) ë°°ê²½ë„ ì–´ë‘¡ê²Œ
                        // MNIST ê°’(ê²€ì •=255)ì„ RGB(ê²€ì •=0)ë¡œ ë³€í™˜í•´ì•¼ í•˜ë¯€ë¡œ 255ì—ì„œ ë¹¼ì¤Œ
                        const displayGray = MAX_PIXEL_VALUE - value;
                        pixel.style.backgroundColor = `rgb(${displayGray}, ${displayGray}, ${displayGray})`;
                        
                        // íˆ´íŒì— í”½ì…€ ìœ„ì¹˜ì™€ ê°’ í‘œì‹œ
                        pixel.title = `(${x},${y}): ${value}`;
                        
                        visualMatrix.appendChild(pixel);
                        
                        // í†µê³„ ê³„ì‚°ì— í•„ìš”í•œ ê°’ ì—…ë°ì´íŠ¸
                        if (value > 0) nonZeroCount++;
                        if (value > maxVal) maxVal = value;
                        if (value < minVal) minVal = value;
                    }
                }
                
                // ì‹œê°ì  í–‰ë ¬ í†µê³„ í‘œì‹œ
                const totalPixels = MATRIX_SIZE * MATRIX_SIZE; // ì „ì²´ í”½ì…€ ìˆ˜ (28*28=784)
                visualStats.innerHTML = `
                    í™œì„± í”½ì…€: ${nonZeroCount}/${totalPixels} (${(nonZeroCount/totalPixels*100).toFixed(1)}%)<br>
                    ê°’ ë²”ìœ„: ${minVal} ~ ${maxVal}
                `;
            }

            // ìˆ«ì í–‰ë ¬ (ê²©ìí˜•) í‘œì‹œ
            displayNumericMatrix(matrix) {
                const numericMatrix = document.getElementById('numericMatrix');
                const numericStats = document.getElementById('numericStats');
                
                numericMatrix.innerHTML = ''; // ì´ì „ ë‚´ìš© ì§€ìš°ê¸°
                
                // 28x28 ê²©ìí˜•ìœ¼ë¡œ ê° ì…€ì— ìˆ«ì ê°’ í‘œì‹œ
                for (let y = 0; y < MATRIX_SIZE; y++) {
                    for (let x = 0; x < MATRIX_SIZE; x++) {
                        const value = matrix[y][x]; // í–‰ë ¬ì—ì„œ í”½ì…€ ê°’ ê°€ì ¸ì˜¤ê¸°
                        const cell = document.createElement('div');
                        cell.className = 'matrix-cell';
                        cell.textContent = value; // ì…€ì— ìˆ«ì ê°’ í‘œì‹œ
                        cell.title = `ìœ„ì¹˜: (${x}, ${y}), ê°’: ${value}`; // íˆ´íŒ
                        
                        // íŠ¹ì • ì„ê³„ê°’(ì˜ˆ: 127)ë³´ë‹¤ í° ê°’(ì–´ë‘ìš´ í”½ì…€)ì„ í•˜ì´ë¼ì´íŠ¸
                        if (value > HIGHLIGHT_THRESHOLD) {
                            cell.classList.add('highlight');
                        }
                        
                        numericMatrix.appendChild(cell); // ê²©ìì— ì…€ ì¶”ê°€
                    }
                }

                // ìˆ«ì í–‰ë ¬ í†µê³„ ê³„ì‚° ë° í‘œì‹œ
                const flatMatrix = matrix.flat(); // 2ì°¨ì› ë°°ì—´ì„ 1ì°¨ì› ë°°ì—´ë¡œ ë³€í™˜
                const sum = flatMatrix.reduce((a, b) => a + b, 0); // ëª¨ë“  ê°’ì˜ í•©ê³„
                const avg = (sum / flatMatrix.length).toFixed(1); // í‰ê·  ê°’
                const nonZeros = flatMatrix.filter(v => v > 0).length; // 0ì´ ì•„ë‹Œ ê°’ì˜ ê°œìˆ˜
                
                numericStats.innerHTML = `
                    ì „ì²´ í‰ê· : ${avg}<br>
                    0ì´ ì•„ë‹Œ ê°’: ${nonZeros}/${MATRIX_SIZE * MATRIX_SIZE}<br>
                `;
            }

            // í´ë¦½ë³´ë“œì— í–‰ë ¬ ë°ì´í„°ë¥¼ íƒ­ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ë³µì‚¬ (ì—‘ì…€ ë¶™ì—¬ë„£ê¸° ìš©ì´)
            copyToClipboard() {
                // currentMatrix ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì¢…ë£Œ
                if (!this.currentMatrix) {
                    console.warn('í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    alert('ë³€í™˜ëœ í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // 2ì°¨ì› ë°°ì—´ì„ íƒ­('\t')ìœ¼ë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ë¡œ ë³€í™˜
                const matrixData = this.currentMatrix.map(row => row.join('\t')).join('\n');
                
                // í´ë¦½ë³´ë“œì— ì“°ê¸°
                navigator.clipboard.writeText(matrixData).then(() => {
                    alert('í–‰ë ¬ ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }).catch(err => {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì • ë˜ëŠ” ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); // ì‚¬ìš©ìì—ê²Œ ë” ìƒì„¸í•œ ì•Œë¦¼
                });
            }

            // í–‰ë ¬ ë°ì´í„°ë¥¼ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
            downloadMatrix() {
                // currentMatrix ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì¢…ë£Œ
                if (!this.currentMatrix) {
                     console.warn('í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                     alert('ë³€í™˜ëœ í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                     return;
                }
                
                // 2ì°¨ì› ë°°ì—´ì„ ì‰¼í‘œ(',')ë¡œ êµ¬ë¶„ëœ CSV ë¬¸ìì—´ë¡œ ë³€í™˜
                const matrixData = this.currentMatrix.map(row => row.join(',')).join('\n');
                
                try {
                    // Blob ê°ì²´ ìƒì„±
                    const blob = new Blob([matrixData], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob); // Blob URL ìƒì„±
                    
                    // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë° í´ë¦­
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'digit_matrix_28x28.csv'; // ë‹¤ìš´ë¡œë“œë  íŒŒì¼ ì´ë¦„
                    document.body.appendChild(a);
                    a.click();
                    
                    // ì‚¬ìš© í›„ Blob URL í•´ì œ (ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ setTimeout ì‚¬ìš©)
                    setTimeout(() => {
                         document.body.removeChild(a);
                         URL.revokeObjectURL(url); // ì‚¬ìš© í›„ Blob URL í•´ì œ
                    }, 100);

                } catch (error) {
                    console.error('CSV ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                    alert('CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }

            // 28x28 í¬ê¸°ì˜ PNG ì´ë¯¸ì§€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
            downloadPNG() {
                // currentMatrix ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì¢…ë£Œ
                if (!this.currentMatrix) {
                     console.warn('í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                     alert('ë³€í™˜ëœ í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                     return;
                }
                
                // ë©”ëª¨ë¦¬ì— 28x28 ìº”ë²„ìŠ¤ ìƒì„±
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                if (!ctx) {
                     console.error('ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                     alert('ì´ë¯¸ì§€ ì²˜ë¦¬ì— í•„ìš”í•œ ìº”ë²„ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                     return;
                }

                canvas.width = MATRIX_SIZE;
                canvas.height = MATRIX_SIZE;
                
                // ì´ë¯¸ì§€ ë°ì´í„° ê°ì²´ ìƒì„±
                const imageData = ctx.createImageData(MATRIX_SIZE, MATRIX_SIZE);
                const data = imageData.data; // í”½ì…€ ë°ì´í„° ë°°ì—´
                
                // í–‰ë ¬ ë°ì´í„°ë¥¼ ì´ë¯¸ì§€ ë°ì´í„°ì˜ RGBA ê°’ìœ¼ë¡œ ë³€í™˜
                for (let y = 0; y < MATRIX_SIZE; y++) {
                    for (let x = 0; x < MATRIX_SIZE; x++) {
                        const index = (y * MATRIX_SIZE + x) * 4; // í”½ì…€ì˜ RGBA ë°ì´í„° ì‹œì‘ ì¸ë±ìŠ¤
                        const value = this.currentMatrix[y][x]; // í–‰ë ¬ì—ì„œ í”½ì…€ ê°’ (0-255)
                        
                        // MNIST ê°’(0-255, ê²€ì •=255)ì„ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ RGB ê°’(0-255, ê²€ì •=0)ìœ¼ë¡œ ë³€í™˜
                        const grayValue = MAX_PIXEL_VALUE - value; // ê°’ ë°˜ì „
                        
                        data[index] = grayValue;     // Red ì±„ë„
                        data[index + 1] = grayValue; // Green ì±„ë„
                        data[index + 2] = grayValue; // Blue ì±„ë„
                        data[index + 3] = MAX_PIXEL_VALUE;       // Alpha ì±„ë„ (ë¶ˆíˆ¬ëª…)
                    }
                }
                
                // ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
                ctx.putImageData(imageData, 0, 0);
                
                // ìº”ë²„ìŠ¤ ë‚´ìš©ì„ PNG Blobìœ¼ë¡œ ë³€í™˜ í›„ ë‹¤ìš´ë¡œë“œ
                canvas.toBlob((blob) => {
                     if (blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'digit_28x28.png';
                        document.body.appendChild(a);
                        a.click();
                        
                        // ì‚¬ìš© í›„ Blob URL í•´ì œ (ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ setTimeout ì‚¬ìš©)
                        setTimeout(() => {
                             document.body.removeChild(a);
                             URL.revokeObjectURL(url); // ì‚¬ìš© í›„ Blob URL í•´ì œ
                        }, 100);
                    } else {
                         console.error('ìº”ë²„ìŠ¤ë¥¼ Blobìœ¼ë¡œ ë³€í™˜ ì‹¤íŒ¨');
                         alert('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                }, 'image/png'); // PNG í˜•ì‹ ì§€ì •
            }

            // 280x280 í¬ê¸°ì˜ PNG ì´ë¯¸ì§€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ (10ë°° í™•ëŒ€)
            downloadPNGLarge() {
                // currentMatrix ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì¢…ë£Œ
                if (!this.currentMatrix) {
                     console.warn('í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                     alert('ë³€í™˜ëœ í–‰ë ¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                     return;
                }
                
                const scaleFactor = 10; // í™•ëŒ€ ë°°ìœ¨
                const largeSize = MATRIX_SIZE * scaleFactor; // í™•ëŒ€ëœ í¬ê¸° (280)
                
                // ë©”ëª¨ë¦¬ì— í™•ëŒ€ëœ í¬ê¸°ì˜ ìº”ë²„ìŠ¤ ìƒì„±
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                 if (!ctx) {
                     console.error('ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                     alert('ì´ë¯¸ì§€ ì²˜ë¦¬ì— í•„ìš”í•œ ìº”ë²„ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                     return;
                }
                
                canvas.width = largeSize;
                canvas.height = largeSize;
                
                // ì´ë¯¸ì§€ ìŠ¤ë¬´ë”© ë¹„í™œì„±í™” (í”½ì…€ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡)
                ctx.imageSmoothingEnabled = false;

                // í”½ì…€ ë‹¨ìœ„ë¡œ ê·¸ë¦¬ê¸° (ê° í–‰ë ¬ ê°’ì„ scaleFactor * scaleFactor í¬ê¸°ì˜ ì‚¬ê°í˜•ìœ¼ë¡œ ì±„ì›€)
                for (let y = 0; y < MATRIX_SIZE; y++) {
                    for (let x = 0; x < MATRIX_SIZE; x++) {
                        const value = this.currentMatrix[y][x]; // í–‰ë ¬ì—ì„œ í”½ì…€ ê°’
                        const grayValue = MAX_PIXEL_VALUE - value; // ê°’ ë°˜ì „ (í‘œì‹œìš©)
                        
                        // í•´ë‹¹ í”½ì…€ì˜ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ìƒ‰ìƒìœ¼ë¡œ ì±„ìš°ê¸° ìŠ¤íƒ€ì¼ ì„¤ì •
                        ctx.fillStyle = `rgb(${grayValue}, ${grayValue}, ${grayValue})`;
                        
                        // í™•ëŒ€ëœ í”½ì…€ ìœ„ì¹˜ì— ì‚¬ê°í˜• ê·¸ë¦¬ê¸°
                        ctx.fillRect(x * scaleFactor, y * scaleFactor, scaleFactor, scaleFactor);
                    }
                }
                
                // ìº”ë²„ìŠ¤ ë‚´ìš©ì„ PNG Blobìœ¼ë¡œ ë³€í™˜ í›„ ë‹¤ìš´ë¡œë“œ
                canvas.toBlob((blob) => {
                     if (blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'digit_280x280.png';
                        document.body.appendChild(a);
                        a.click();
                        
                        // ì‚¬ìš© í›„ Blob URL í•´ì œ (ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ setTimeout ì‚¬ìš©)
                        setTimeout(() => {
                             document.body.removeChild(a);
                             URL.revokeObjectURL(url); // ì‚¬ìš© í›„ Blob URL í•´ì œ
                        }, 100);
                    } else {
                         console.error('ìº”ë²„ìŠ¤ë¥¼ Blobìœ¼ë¡œ ë³€í™˜ ì‹¤íŒ¨');
                         alert('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                }, 'image/png'); // PNG í˜•ì‹ ì§€ì •
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì•± ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            new DigitCanvasConverter();
        });
    </script>
</body>
</html>