<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ğŸ” SEO (ê²€ìƒ‰ì—”ì§„ ìµœì í™”) -->
    <meta name="description" content="ë‘ ì´ë¯¸ì§€ë¥¼ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜, ë¸”ë Œë”©í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ í”½ì…€ ë°ê¸°ê°’ í–‰ë ¬ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ í•©ì„±ì˜ ìˆ˜í•™ì  ì›ë¦¬ë¥¼ í–‰ë ¬ ë°ì´í„°ë¡œ íƒêµ¬í•´ ë³´ì„¸ìš”.">
    <meta name="keywords" content="ì´ë¯¸ì§€ ë¸”ë Œë”©, í–‰ë ¬ ì‹œê°í™”, ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜, í”½ì…€ í–‰ë ¬, ì´ë¯¸ì§€ í•©ì„± ìˆ˜í•™, ì¸ê³µì§€ëŠ¥ ìˆ˜í•™, ìˆ˜í•™ ì‹¤í—˜, êµìœ¡ í™œë™">
    <meta name="author" content="í™©ì„±í˜„">
    <meta name="google-site-verification" content="s7dTY3TNe-PjxGrl--MTPXDXJcgD2V7_6MDZ4SoEDP8" />
    <meta name="naver-site-verification" content="c020330e12eea0ae1a607097941a61b11590df69" />

    <!-- ğŸ“± SNS ê³µìœ  (Open Graph) -->
    <meta property="og:title" content="ì´ë¯¸ì§€ ë¸”ë Œë”© í–‰ë ¬ ì‹œê°í™” - ì¸ê³µì§€ëŠ¥ ìˆ˜í•™ íƒêµ¬">
    <meta property="og:description" content="ë‘ ì´ë¯¸ì§€ë¥¼ í˜¼í•©í•˜ê³  ê·¸ë ˆì´ìŠ¤ì¼€ì¼ í–‰ë ¬ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ ì´ë¯¸ì§€ í•©ì„±ì˜ ìˆ˜í•™ì  ì›ë¦¬ë¥¼ íƒêµ¬í•©ë‹ˆë‹¤.">
    <meta property="og:image" content="https://tjdgus1121.github.io/thumbnail.png">
    <meta property="og:url" content="https://tjdgus1121.github.io/activity6_composite_explore.html">
    <meta property="og:type" content="website">

    <!-- ğŸ” SEO (ì¶”ê°€ ë©”íƒ€ë°ì´í„°) -->
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://tjdgus1121.github.io/activity6_composite_explore.html">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ì´ë¯¸ì§€ ë¸”ë Œë”© í–‰ë ¬ ì‹œê°í™”">
    <meta name="twitter:description" content="ì´ë¯¸ì§€ ë¸”ë Œë”© ê²°ê³¼ë¥¼ í–‰ë ¬ë¡œ ì‹œê°í™”í•˜ê³  ìˆ˜í•™ì  ì›ë¦¬ë¥¼ íƒêµ¬í•˜ëŠ” í™œë™ í˜ì´ì§€.">
    <meta name="twitter:image" content="https://tjdgus1121.github.io/thumbnail.png">

    <meta name="subject" content="AI ìˆ˜í•™ êµìœ¡ ì²´í—˜">
    <meta name="theme-color" content="#ff9a9e">
    <meta name="copyright" content="í™©ì„±í˜„">
    <meta name="reply-to" content="tjdgus1121@naver.com">
    <meta name="url" content="https://tjdgus1121.github.io/activity6_composite_explore.html">

    <title>ì´ë¯¸ì§€ ë¸”ë Œë”© í–‰ë ¬ ì‹œê°í™”</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Jua&family=Nanum+Pen+Script&family=Noto+Sans+KR:wght@100..900&family=Orbitron:wght@400..900&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="stylefooter.css">
    <style>
         body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
      font-size: clamp(1.5rem, 4vw, 2rem);
    }
    .titleh3{
        color:rgb(77, 77, 77);
        font-size:15px;
        width:700px;
        margin:10px auto;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .top-section {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .upload-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
      min-width: 250px;
    }

    .upload-card, .result-image-container, .controls-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      flex: 1;
      min-width: 250px;
    }

    .preview-container {
      position: relative;
      height: 150px;
      background-color: #eee;
      border: 2px dashed #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .preview-image {
      max-width: 100%;
      max-height: 100%;
      display: none;
    }

    input[type="file"] {
      margin-top: 10px;
    }

    .result-canvas {
      width: 100%;
      max-height: 200px;
      background-color: #eee;
    }

    .controls-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .options-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .size-input {
      width: 60px;
      text-align: center;
    }

    .mode-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .mode-button {
      padding: 8px 12px;
      background-color: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }

    .mode-button.active {
      background-color: #4CAF50;
      color: white;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .slider {
      flex: 1;
    }

    .matrix-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .matrix-header {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .matrix-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .control-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    .download-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 15px;
      font-weight: bold;
      cursor: pointer;
    }

    .matrix-wrapper {
      overflow-x: auto;
      max-height: 500px;
    }

    .matrix-table {
      border-collapse: collapse;
      width: 100%;
      font-size: 12px;
    }

    .matrix-table td {
      border: 1px solid #ddd;
      text-align: center;
      padding: 4px;
      min-width: 30px;
    }

    .pixel-info {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
      text-align: center;
      background-color: #f0f0f0;
      padding: 5px;
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      .top-section {
        flex-direction: column;
        gap: 20px;
      }
    }
    </style>
</head>

<body>
    <h1>ì´ë¯¸ì§€ ë¸”ë Œë”© í–‰ë ¬ ì‹œê°í™”</h1>
    <h3 class="titleh3">ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´, ì´ë¯¸ì§€ë¥¼ ë™ì¼í•œ ì‚¬ì´ì¦ˆë¡œ ë Œë”ë§ í•œ í›„ í‘ë°±ì‚¬ì§„ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ í•©ì„±í•©ë‹ˆë‹¤.<br>ì˜¤ë¥¸ìª½ì˜ ìŠ¤í¬ë¡¤ì„ ì¡°ì ˆí•˜ë©° í–‰ë ¬ë°ì´í„°ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ì‚´í´ë³´ì„¸ìš”.</h3>
    <div class="container">
        <!-- ìƒë‹¨ ì„¹ì…˜: ì´ë¯¸ì§€ ì—…ë¡œë“œ, ê²°ê³¼ ì´ë¯¸ì§€, ì»¨íŠ¸ë¡¤ -->
        <div class="top-section">
            <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div class="upload-section">
                <div class="upload-card">
                    <h3 class="upload-title">ì´ë¯¸ì§€ 1</h3>
                    <div class="preview-container" id="preview1">
                        <p class="drop-text">ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”</p>
                        <img class="preview-image" id="previewImage1">
                    </div>
                    <input type="file" id="imageInput1" accept="image/*" title="ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ">
                </div>

                <div class="upload-card">
                    <h3 class="upload-title">ì´ë¯¸ì§€ 2</h3>
                    <div class="preview-container" id="preview2">
                        <p class="drop-text">ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”</p>
                        <img class="preview-image" id="previewImage2">
                    </div>
                    <input type="file" id="imageInput2" accept="image/*" title="ë‘ ë²ˆì§¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ">
                </div>
            </div>

            <!-- ê²°ê³¼ ì´ë¯¸ì§€ ì„¹ì…˜ -->
            <div class="result-image-container">
                <h3>ê²°ê³¼ ì´ë¯¸ì§€</h3>
                <canvas id="resultCanvas" class="result-canvas"></canvas>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ ì„¹ì…˜ -->
            <div class="controls-section">
                <div>
                    <div class="options-container">
                        <div>
                            <label for="widthInput">ë„ˆë¹„: </label>
                            <input type="number" id="widthInput" class="size-input" value="20" min="5" max="100">
                            <label for="heightInput">ë†’ì´: </label>
                            <input type="number" id="heightInput" class="size-input" value="20" min="5" max="100">
                            <button id="resizeButton" class="resize-button">í¬ê¸° ì ìš©</button>
                        </div>

                        <div class="mode-buttons">
                            <button id="numberMode" class="mode-button">ìˆ«ì ëª¨ë“œ</button>
                            <button id="colorMode" class="mode-button">ì»¬ëŸ¬ ëª¨ë“œ</button>
                            <button id="mixedMode" class="mode-button active">í˜¼í•© ëª¨ë“œ</button>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label for="blendSlider">í˜¼í•© ë¹„ìœ¨: </label>
                        <span id="sliderValue" class="slider-value">50%</span>
                        <input type="range" id="blendSlider" class="slider" min="0" max="100" value="50">
                    </div>
                </div>
            </div>
        </div>

        <!-- í–‰ë ¬ í‘œì‹œ ì„¹ì…˜ (ì „ì²´ ë„ˆë¹„ ì‚¬ìš©) -->
        <div class="matrix-section">
            <div class="matrix-header">
                <h3 class="matrix-title">í”½ì…€ ë°ê¸°ê°’ í–‰ë ¬</h3>

                <div class="matrix-controls">
                    <div class="zoom-control">
                        <button id="zoomOut" class="control-button">-</button>
                        <span class="zoom-value" id="zoomValue">100%</span>
                        <button id="zoomIn" class="control-button">+</button>
                    </div>

                    <div class="zoom-control">
                        <button id="decreaseSize" class="control-button">-</button>
                        <span>ì…€ í¬ê¸°: <span id="cellSizeValue">36</span>px</span>
                        <button id="increaseSize" class="control-button">+</button>
                    </div>

                    <button id="downloadCSV" class="download-button">CSV ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>

            <div class="matrix-wrapper" id="matrixWrapper">
                <div class="matrix-container" id="matrixContainer">
                    <table id="matrixTable" class="matrix-table"></table>
                </div>
            </div>

            <div id="pixelInfo" class="pixel-info">í”½ì…€ì„ í´ë¦­í•˜ë©´ ì¢Œí‘œì™€ ë°ê¸°ê°’ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div>
                <div class="footer-logo">ì¸ê³µì§€ëŠ¥ ìˆ˜í•™ ì´ë¯¸ì§€ íƒêµ¬ í™œë™ ì‚¬ì´íŠ¸</div>
                <div class="creator-info">
                    Designed & Developed by <span>í™©ì„±í˜„</span><br>
                    Contact : tjdgus1121@naver.com
                </div>
            </div>

            <div class="social-links">
                <a href="mailto:tjdgus1121@naver.com" id="email-link"><i class="fa-solid fa-envelope"></i></a>
                <a href="https://mail.naver.com/write/popup?to=tjdgus1121@naver.com" target="_blank" rel="noopener">
                    <img src="naver.png" alt="ë©”ì¼ ë³´ë‚´ê¸°"
                        style="height:25px; filter: grayscale(100%); transition: filter 0.3s;"
                        onmouseover="this.style.filter='grayscale(0%)';"
                        onmouseout="this.style.filter='grayscale(100%)';">
                </a>
            </div>

            <div class="copyright">
                ì´ ì‚¬ì´íŠ¸ì˜ ëª¨ë“  ì½˜í…ì¸ ëŠ” ì •ì„±ê» ë§Œë“  ì €ì‘ë¬¼ì…ë‹ˆë‹¤. â“’ <span id="current-year"></span><br>
                ë‹¤ë§Œ, ì¸ê³µì§€ëŠ¥ ìˆ˜í•™ êµìœ¡ì„ í•¨ê»˜ ê³ ë¯¼í•˜ëŠ” ëª¨ë“  ì„ ìƒë‹˜ë“¤ê»˜ ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
            </div>

    </footer>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        const state = {
            image1: null,
            image2: null,
            grayImage1: [],
            grayImage2: [],
            resultImage: [],
            width: 20,
            height: 20,
            mode: 'mixed', // 'number', 'color', 'mixed'
            blendRatio: 0.5,
            cellSize: 36, // ì…€ í¬ê¸° ê¸°ë³¸ê°’ (í”½ì…€)
            zoomLevel: 1 // í™•ëŒ€/ì¶•ì†Œ ìˆ˜ì¤€ (1 = 100%)
        };

        // DOM ìš”ì†Œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function () {
            // ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨ ìš”ì†Œ
            const imageInput1 = document.getElementById('imageInput1');
            const imageInput2 = document.getElementById('imageInput2');
            const previewImage1 = document.getElementById('previewImage1');
            const previewImage2 = document.getElementById('previewImage2');

            // ì»¨íŠ¸ë¡¤ ê´€ë ¨ ìš”ì†Œ
            const blendSlider = document.getElementById('blendSlider');
            const sliderValue = document.getElementById('sliderValue');
            const widthInput = document.getElementById('widthInput');
            const heightInput = document.getElementById('heightInput');
            const resizeButton = document.getElementById('resizeButton');

            // ëª¨ë“œ ë²„íŠ¼
            const numberMode = document.getElementById('numberMode');
            const colorMode = document.getElementById('colorMode');
            const mixedMode = document.getElementById('mixedMode');

            // ê²°ê³¼ ê´€ë ¨ ìš”ì†Œ
            const resultCanvas = document.getElementById('resultCanvas');
            const matrixTable = document.getElementById('matrixTable');
            const matrixContainer = document.getElementById('matrixContainer');
            const pixelInfo = document.getElementById('pixelInfo');
            const downloadCSV = document.getElementById('downloadCSV');

            // ì…€ í¬ê¸° ì¡°ì ˆ ìš”ì†Œ
            const increaseSize = document.getElementById('increaseSize');
            const decreaseSize = document.getElementById('decreaseSize');
            const cellSizeValue = document.getElementById('cellSizeValue');

            // í™•ëŒ€/ì¶•ì†Œ ì¡°ì ˆ ìš”ì†Œ
            const zoomIn = document.getElementById('zoomIn');
            const zoomOut = document.getElementById('zoomOut');
            const zoomValue = document.getElementById('zoomValue');

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            imageInput1.addEventListener('change', (e) => handleImageUpload(e, 1));
            imageInput2.addEventListener('change', (e) => handleImageUpload(e, 2));

            blendSlider.addEventListener('input', handleSliderChange);
            resizeButton.addEventListener('click', applyResize);

            numberMode.addEventListener('click', () => setDisplayMode('number'));
            colorMode.addEventListener('click', () => setDisplayMode('color'));
            mixedMode.addEventListener('click', () => setDisplayMode('mixed'));

            downloadCSV.addEventListener('click', downloadMatrixAsCSV);

            // ì…€ í¬ê¸° ì¡°ì ˆ ì´ë²¤íŠ¸
            increaseSize.addEventListener('click', () => {
                if (state.cellSize < 100) {
                    state.cellSize += 4;
                    cellSizeValue.textContent = state.cellSize;
                    updateMatrixDisplay();
                }
            });

            decreaseSize.addEventListener('click', () => {
                if (state.cellSize > 20) {
                    state.cellSize -= 4;
                    cellSizeValue.textContent = state.cellSize;
                    updateMatrixDisplay();
                }
            });

            // í™•ëŒ€/ì¶•ì†Œ ì´ë²¤íŠ¸
            zoomIn.addEventListener('click', () => {
                if (state.zoomLevel < 2) {
                    state.zoomLevel += 0.1;
                    updateZoom();
                }
            });

            zoomOut.addEventListener('click', () => {
                if (state.zoomLevel > 0.1) {
                    state.zoomLevel -= 0.1;
                    updateZoom();
                }
            });

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
            setupDragDrop('preview1', 1);
            setupDragDrop('preview2', 2);

            // ì´ˆê¸° ë„ˆë¹„/ë†’ì´ ê°’ ì ìš©
            state.width = parseInt(widthInput.value);
            state.height = parseInt(heightInput.value);

            // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            initializeCanvas();
        });

        // í™•ëŒ€/ì¶•ì†Œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateZoom() {
            const matrixContainer = document.getElementById('matrixContainer');
            const zoomValue = document.getElementById('zoomValue');

            matrixContainer.style.transform = `scale(${state.zoomLevel})`;
            zoomValue.textContent = `${Math.round(state.zoomLevel * 100)}%`;
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì • í•¨ìˆ˜
        function setupDragDrop(previewId, imageNumber) {
            const previewContainer = document.getElementById(previewId);

            previewContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                previewContainer.style.borderColor = '#4CAF50';
            });

            previewContainer.addEventListener('dragleave', () => {
                previewContainer.style.borderColor = '#ccc';
            });

            previewContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                previewContainer.style.borderColor = '#ccc';

                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();

                        reader.onload = function (e) {
                            const img = new Image();
                            img.onload = function () {
                                if (imageNumber === 1) {
                                    state.image1 = img;
                                } else {
                                    state.image2 = img;
                                }

                                // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ í‘œì‹œ
                                const previewImage = document.getElementById(`previewImage${imageNumber}`);
                                previewImage.src = e.target.result;
                                previewImage.style.display = 'block';

                                // ë“œë¡­ í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
                                const dropText = previewContainer.querySelector('.drop-text');
                                dropText.style.display = 'none';

                                // ì´ë¯¸ì§€ ì²˜ë¦¬
                                processImages();
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                }
            });
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ í•¨ìˆ˜
        function handleImageUpload(event, imageNumber) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();

            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    if (imageNumber === 1) {
                        state.image1 = img;
                    } else {
                        state.image2 = img;
                    }

                    // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ í‘œì‹œ
                    const previewImage = document.getElementById(`previewImage${imageNumber}`);
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';

                    // ë“œë¡­ í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
                    const previewContainer = document.getElementById(`preview${imageNumber}`);
                    const dropText = previewContainer.querySelector('.drop-text');
                    dropText.style.display = 'none';

                    // ì´ë¯¸ì§€ ì²˜ë¦¬
                    processImages();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ìŠ¬ë¼ì´ë” ë³€ê²½ ì²˜ë¦¬ í•¨ìˆ˜
        function handleSliderChange(event) {
            const value = event.target.value;
            state.blendRatio = value / 100;

            // ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('sliderValue').textContent = value + '%';

            // ì´ë¯¸ì§€ ì²˜ë¦¬
            blendImages();
            updateResultsDisplay();
        }

        // ë¦¬ì‚¬ì´ì¦ˆ ì ìš© í•¨ìˆ˜
        function applyResize() {
            const widthInput = document.getElementById('widthInput');
            const heightInput = document.getElementById('heightInput');

            state.width = parseInt(widthInput.value);
            state.height = parseInt(heightInput.value);

            // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
            initializeCanvas();

            // ì´ë¯¸ì§€ ì²˜ë¦¬
            processImages();
        }

        // ë””ìŠ¤í”Œë ˆì´ ëª¨ë“œ ì„¤ì • í•¨ìˆ˜
        function setDisplayMode(mode) {
            state.mode = mode;

            // ëª¨ë“œ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('numberMode').classList.remove('active');
            document.getElementById('colorMode').classList.remove('active');
            document.getElementById('mixedMode').classList.remove('active');

            document.getElementById(`${mode}Mode`).classList.add('active');

            // í–‰ë ¬ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateMatrixDisplay();
        }

        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” í•¨ìˆ˜
        function initializeCanvas() {
            const resultCanvas = document.getElementById('resultCanvas');
            const ctx = resultCanvas.getContext('2d');

            resultCanvas.width = state.width;
            resultCanvas.height = state.height;

            // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” (ê²€ì€ìƒ‰)
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, state.width, state.height);
        }

        // ì´ë¯¸ì§€ ì²˜ë¦¬ ë©”ì¸ í•¨ìˆ˜
        function processImages() {
            if (!state.image1 || !state.image2) return;

            // ì´ë¯¸ì§€ë¥¼ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜
            state.grayImage1 = convertToGrayscale(state.image1);
            state.grayImage2 = convertToGrayscale(state.image2);

            // ì´ë¯¸ì§€ í˜¼í•©
            blendImages();

            // ê²°ê³¼ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateResultsDisplay();
        }

        // ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜ í•¨ìˆ˜
        function convertToGrayscale(image) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            canvas.width = state.width;
            canvas.height = state.height;

            // ì´ë¯¸ì§€ë¥¼ ìº”ë²„ìŠ¤ í¬ê¸°ì— ë§ê²Œ ê·¸ë¦¬ê¸°
            ctx.drawImage(image, 0, 0, state.width, state.height);

            // í”½ì…€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const imageData = ctx.getImageData(0, 0, state.width, state.height);
            const pixels = imageData.data;

            // ê·¸ë ˆì´ìŠ¤ì¼€ì¼ í–‰ë ¬ ìƒì„±
            const grayMatrix = Array(state.height).fill().map(() => Array(state.width).fill(0));

            // í”½ì…€ ë‹¨ìœ„ë¡œ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜
            for (let y = 0; y < state.height; y++) {
                for (let x = 0; x < state.width; x++) {
                    const i = (y * state.width + x) * 4;

                    // ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜ ê³µì‹: gray = 0.299*R + 0.587*G + 0.114*B
                    const gray = Math.round(
                        0.299 * pixels[i] +      // R
                        0.587 * pixels[i + 1] +  // G
                        0.114 * pixels[i + 2]    // B
                    );

                    grayMatrix[y][x] = gray;

                    // ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ê°’ìœ¼ë¡œ í”½ì…€ ì—…ë°ì´íŠ¸
                    pixels[i] = pixels[i + 1] = pixels[i + 2] = gray;
                }
            }

            // ì—…ë°ì´íŠ¸ëœ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
            ctx.putImageData(imageData, 0, 0);

            return grayMatrix;
        }

        // ì´ë¯¸ì§€ í˜¼í•© í•¨ìˆ˜
        function blendImages() {
            if (!state.grayImage1.length || !state.grayImage2.length) return;

            const alpha = state.blendRatio;

            // ê²°ê³¼ í–‰ë ¬ ì´ˆê¸°í™”
            state.resultImage = Array(state.height).fill().map(() => Array(state.width).fill(0));

            // í”½ì…€ ë‹¨ìœ„ë¡œ í˜¼í•©
            for (let y = 0; y < state.height; y++) {
                for (let x = 0; x < state.width; x++) {
                    // í˜¼í•© ê³µì‹: result = alpha * img1 + (1 - alpha) * img2
                    state.resultImage[y][x] = Math.round(
                        alpha * state.grayImage1[y][x] +
                        (1 - alpha) * state.grayImage2[y][x]
                    );
                }
            }
        }

        // ê²°ê³¼ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateResultsDisplay() {
            // ê²°ê³¼ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            updateResultImage();

            // í–‰ë ¬ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateMatrixDisplay();
        }

        // ê²°ê³¼ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateResultImage() {
            if (!state.resultImage.length) return;

            const resultCanvas = document.getElementById('resultCanvas');
            const ctx = resultCanvas.getContext('2d');

            // ì´ë¯¸ì§€ ë°ì´í„° ìƒì„±
            const imageData = ctx.createImageData(state.width, state.height);
            const pixels = imageData.data;

            // í”½ì…€ ë°ì´í„° ì„¤ì •
            for (let y = 0; y < state.height; y++) {
                for (let x = 0; x < state.width; x++) {
                    const i = (y * state.width + x) * 4;
                    const gray = state.resultImage[y][x];

                    pixels[i] = pixels[i + 1] = pixels[i + 2] = gray;
                    pixels[i + 3] = 255; // ì•ŒíŒŒ ì±„ë„ (ë¶ˆíˆ¬ëª…)
                }
            }

            // ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
            ctx.putImageData(imageData, 0, 0);
        }

        // í–‰ë ¬ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMatrixDisplay() {
            if (!state.resultImage.length) return;

            const matrixTable = document.getElementById('matrixTable');

            // í…Œì´ë¸” ì´ˆê¸°í™”
            matrixTable.innerHTML = '';

            // í–‰ë ¬ ë°ì´í„°ë¡œ í…Œì´ë¸” ìƒì„±
            for (let y = 0; y < state.height; y++) {
                const row = document.createElement('tr');

                for (let x = 0; x < state.width; x++) {
                    const cell = document.createElement('td');
                    const gray = state.resultImage[y][x];

                    // ì…€ í¬ê¸° ì„¤ì •
                    cell.style.width = `${state.cellSize}px`;
                    cell.style.height = `${state.cellSize}px`;

                    // ì…€ ë‚´ìš© ì„¤ì • (ëª¨ë“œì— ë”°ë¼)
                    if (state.mode === 'number' || state.mode === 'mixed') {
                        cell.textContent = gray;
                    }

                    // ì…€ ë°°ê²½ìƒ‰ ì„¤ì • (ëª¨ë“œì— ë”°ë¼)
                    if (state.mode === 'color' || state.mode === 'mixed') {
                        cell.style.backgroundColor = `rgb(${gray}, ${gray}, ${gray})`;

                        // ë°ê¸°ì— ë”°ë¼ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì¡°ì • (ê°€ë…ì„± í–¥ìƒ)
                        if (gray < 128) {
                            cell.style.color = 'white';
                        } else {
                            cell.style.color = 'black';
                        }
                    }

                    // í°íŠ¸ í¬ê¸° ì¡°ì • (ì…€ í¬ê¸°ì— ë¹„ë¡€)
                    const fontSize = Math.max(10, Math.min(16, state.cellSize / 3));
                    cell.style.fontSize = `${fontSize}px`;

                    // ì…€ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.dataset.value = gray;
                    cell.addEventListener('click', showPixelInfo);

                    row.appendChild(cell);
                }

                matrixTable.appendChild(row);
            }
        }

        // í”½ì…€ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
        function showPixelInfo(event) {
            const cell = event.target;
            const x = cell.dataset.x;
            const y = cell.dataset.y;
            const value = cell.dataset.value;

            const pixelInfo = document.getElementById('pixelInfo');
            pixelInfo.textContent = `ì¢Œí‘œ: (${x}, ${y}), ë°ê¸°ê°’: ${value}`;
        }

        // CSV ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        function downloadMatrixAsCSV() {
            if (!state.resultImage.length) return;

            // CSV ë°ì´í„° ìƒì„±
            let csvContent = '';

            // í–‰ë ¬ ë°ì´í„°ë¥¼ CSV í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            for (let y = 0; y < state.height; y++) {
                const row = state.resultImage[y].join(',');
                csvContent += row + '\n';
            }

            // CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', 'image_matrix.csv');
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>

</html>